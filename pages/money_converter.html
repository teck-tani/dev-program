<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>환율계산기 | 실시간 통화 환율 변환 | Tani DevTool</title>
    <meta name="description" content="실시간 환율로 세계 각국의 통화를 쉽게 변환할 수 있는 무료 온라인 환율계산기입니다. 한국 원화, 미국 달러, 유로, 일본 엔 등 다양한 통화 지원.">
    <meta name="keywords" content="환율계산기, 환율변환, 실시간 환율, 통화 변환, 외화 계산, 원화 환율, 달러 환율, 엔화 환율, 유로 환율">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tani-devtool.netlify.app/pages/money_converter.html">
    <meta property="og:title" content="환율계산기 | 실시간 통화 환율 변환">
    <meta property="og:description" content="실시간 환율로 세계 각국의 통화를 쉽게 변환할 수 있는 무료 온라인 환율계산기입니다. 원화, 달러, 유로, 엔화 등 다양한 통화 지원.">
    <meta property="og:image" content="https://tani-devtool.netlify.app/images/money-converter-preview.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://tani-devtool.netlify.app/pages/money_converter.html">
    <meta property="twitter:title" content="환율계산기 | 실시간 통화 환율 변환">
    <meta property="twitter:description" content="실시간 환율로 세계 각국의 통화를 쉽게 변환할 수 있는 무료 온라인 환율계산기입니다.">
    <meta property="twitter:image" content="https://tani-devtool.netlify.app/images/money-converter-preview.png">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://tani-devtool.netlify.app/pages/money_converter.html">
    
    <!-- Robots meta tag -->
    <meta name="robots" content="index, follow">
    
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="../js/common.js"></script>
    
    <!-- 구조화된 데이터 -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "환율계산기 - 실시간 통화 환율 변환",
      "url": "https://tani-devtool.netlify.app/pages/money_converter.html",
      "description": "실시간 환율로 세계 각국의 통화를 쉽게 변환할 수 있는 무료 온라인 환율계산기입니다.",
      "applicationCategory": "FinanceApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "KRW"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.7",
        "ratingCount": "124"
      }
    }
    </script>
    <style>
        .section-title {
            margin-top: 30px;
            text-align: center;
            font-size: 2rem;
            color: #333;
        }
        .currency-form {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .currency-rows {
            margin-bottom: 20px;
        }
        .currency-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        .currency-select {
            flex: 0 0 200px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .currency-select img {
            width: 24px;
            height: 16px;
            object-fit: cover;
        }
        .currency-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .loading {
            text-align: center;
            margin: 20px 0;
        }
        .error-message {
            color: red;
            margin: 10px 0;
        }
        .update-time {
            margin-top: 20px;
            text-align: right;
            font-size: 14px;
            color: #666;
        }
        .faq-section {
            margin-top: 40px;
            background: #f9f9f9;
            padding: 30px 0;
        }
        .faq-item {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .faq-item h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #333;
        }
        .comments-section {
            margin-top: 40px;
            padding: 30px 0;
        }
        .comments-container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* 국가 선택 팝업 스타일 */
        .country-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 1000;
            overflow: hidden;
        }
        .country-popup.active {
            display: block;
        }
        .country-popup-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .country-popup-header h3 {
            margin: 0;
            font-size: 1.2rem;
        }
        .country-popup-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        .country-search {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        .country-search input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        .country-list {
            max-height: calc(80vh - 120px);
            overflow-y: auto;
        }
        .country-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        .country-item:hover {
            background: #f5f5f5;
        }
        .country-item img {
            width: 24px;
            height: 16px;
            object-fit: cover;
        }
        .country-item span {
            flex: 1;
        }
        .country-item .currency-code {
            color: #666;
            font-size: 0.9rem;
        }
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        .overlay.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- top-container가 로드될 자리 -->
    <div id="top-container"></div>
    
    <h1 class="section-title">환율계산기 - 실시간 통화 환율 변환</h1>
    
    <div class="container">
        <p>실시간 환율로 통화를 쉽게 변환할 수 있는 무료 온라인 환율계산기입니다. 아래 금액을 수정하면 자동으로 다른 통화의 금액이 업데이트됩니다.</p>
        
        <div class="currency-form">
            <div id="loading" class="loading">환율 정보를 가져오는 중...</div>
            <div id="error-message" class="error-message"></div>
            <div id="currency-rows" class="currency-rows"></div>
            <div id="update-time" class="update-time"></div>
        </div>
    </div>

    <!-- 국가 선택 팝업 -->
    <div class="overlay" id="overlay"></div>
    <div class="country-popup" id="countryPopup">
        <div class="country-popup-header">
            <h3>국가 선택</h3>
            <button class="country-popup-close">&times;</button>
        </div>
        <div class="country-search">
            <input type="text" id="countrySearch" placeholder="국가명 또는 통화코드로 검색">
        </div>
        <div class="country-list" id="countryList"></div>
    </div>

    <!-- FAQ 섹션 -->
    <div class="faq-section">
        <div class="container">
            <h2>환율계산기 자주 묻는 질문</h2>
            
            <div class="faq-item">
                <h3>환율 정보는 어떻게 업데이트 되나요?</h3>
                <p>본 환율계산기는 ExchangeRate-API를 통해 실시간으로 최신 환율 정보를 제공합니다. 환율은 주기적으로 업데이트되며, 각 계산 화면 하단에 마지막 업데이트 시간이 표시됩니다.</p>
            </div>
            
            <div class="faq-item">
                <h3>지원하는 통화는 어떤 것이 있나요?</h3>
                <p>주요 통화로는 한국 원화(KRW), 미국 달러(USD), 유로(EUR), 일본 엔(JPY), 중국 위안(CNY), 영국 파운드(GBP) 등이 있습니다. 그 외에도 캐나다 달러(CAD), 호주 달러(AUD), 홍콩 달러(HKD), 싱가포르 달러(SGD), 태국 바트(THB) 등을 지원합니다.</p>
            </div>
            
            <div class="faq-item">
                <h3>계산 결과는 얼마나 정확한가요?</h3>
                <p>본 환율계산기는 국제 금융 시장에서 사용되는 실시간 환율 정보를 기반으로 합니다. 다만, 실제 은행이나 환전소에서는 자체 수수료나 스프레드를 적용하므로 약간의 차이가 있을 수 있습니다.</p>
            </div>
            
            <div class="faq-item">
                <h3>오프라인에서도 사용할 수 있나요?</h3>
                <p>이 계산기는 인터넷 연결이 필요하며, 환율 정보를 실시간으로 불러오기 위해서는 온라인 상태여야 합니다. 최근 환율 데이터는 잠시 캐시되지만, 정확한 계산을 위해서는 인터넷 연결을 권장합니다.</p>
            </div>
        </div>
    </div>

    <!-- 방명록 섹션 -->
    <section class="comments-section">
        <div class="container">
            <div class="comments-container">
                <div id="disqus_thread"></div>
            </div>
        </div>
    </section>
    
    <script>
        var disqus_config = function () {
            this.page.url = window.location.href;
            this.page.identifier = 'money-converter';
            this.page.title = document.title;
        };

        (function () {
            var d = document, s = d.createElement('script');
            s.src = 'https://tani-devtool.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>댓글을 보려면 자바스크립트를 활성화해주세요</noscript>

    <!-- footer-container가 로드될 자리 -->
    <div id="footer-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const currencyRowsDiv = document.getElementById('currency-rows');
            const loadingDiv = document.getElementById('loading');
            const errorMessageDiv = document.getElementById('error-message');
            const updateTimeDiv = document.getElementById('update-time');
            const countryPopup = document.getElementById('countryPopup');
            const overlay = document.getElementById('overlay');
            const countrySearch = document.getElementById('countrySearch');
            const countryList = document.getElementById('countryList');
            const closeButton = document.querySelector('.country-popup-close');

            // 모든 국가와 통화 정보
            const countries = [
                { code: 'KRW', name: '한국', flag: 'https://flagcdn.com/w20/kr.png' },
                { code: 'USD', name: '미국', flag: 'https://flagcdn.com/w20/us.png' },
                { code: 'EUR', name: '유럽연합', flag: 'https://flagcdn.com/w20/eu.png' },
                { code: 'JPY', name: '일본', flag: 'https://flagcdn.com/w20/jp.png' },
                { code: 'CNY', name: '중국', flag: 'https://flagcdn.com/w20/cn.png' },
                { code: 'GBP', name: '영국', flag: 'https://flagcdn.com/w20/gb.png' },
                { code: 'CAD', name: '캐나다', flag: 'https://flagcdn.com/w20/ca.png' },
                { code: 'AUD', name: '호주', flag: 'https://flagcdn.com/w20/au.png' },
                { code: 'HKD', name: '홍콩', flag: 'https://flagcdn.com/w20/hk.png' },
                { code: 'SGD', name: '싱가포르', flag: 'https://flagcdn.com/w20/sg.png' },
                { code: 'THB', name: '태국', flag: 'https://flagcdn.com/w20/th.png' },
                { code: 'INR', name: '인도', flag: 'https://flagcdn.com/w20/in.png' },
                { code: 'IDR', name: '인도네시아', flag: 'https://flagcdn.com/w20/id.png' },
                { code: 'MYR', name: '말레이시아', flag: 'https://flagcdn.com/w20/my.png' },
                { code: 'PHP', name: '필리핀', flag: 'https://flagcdn.com/w20/ph.png' },
                { code: 'VND', name: '베트남', flag: 'https://flagcdn.com/w20/vn.png' },
                { code: 'BRL', name: '브라질', flag: 'https://flagcdn.com/w20/br.png' },
                { code: 'MXN', name: '멕시코', flag: 'https://flagcdn.com/w20/mx.png' },
                { code: 'RUB', name: '러시아', flag: 'https://flagcdn.com/w20/ru.png' },
                { code: 'CHF', name: '스위스', flag: 'https://flagcdn.com/w20/ch.png' },
                { code: 'SEK', name: '스웨덴', flag: 'https://flagcdn.com/w20/se.png' },
                { code: 'NOK', name: '노르웨이', flag: 'https://flagcdn.com/w20/no.png' },
                { code: 'DKK', name: '덴마크', flag: 'https://flagcdn.com/w20/dk.png' },
                { code: 'NZD', name: '뉴질랜드', flag: 'https://flagcdn.com/w20/nz.png' },
                { code: 'ZAR', name: '남아프리카', flag: 'https://flagcdn.com/w20/za.png' },
                { code: 'TRY', name: '터키', flag: 'https://flagcdn.com/w20/tr.png' },
                { code: 'AED', name: '아랍에미리트', flag: 'https://flagcdn.com/w20/ae.png' },
                { code: 'SAR', name: '사우디아라비아', flag: 'https://flagcdn.com/w20/sa.png' },
                { code: 'ILS', name: '이스라엘', flag: 'https://flagcdn.com/w20/il.png' },
                { code: 'EGP', name: '이집트', flag: 'https://flagcdn.com/w20/eg.png' }
            ];

            // 통화 이름
            const currencyNames = {
                'KRW': '한국 원화',
                'USD': '미국 달러',
                'EUR': '유로',
                'JPY': '일본 엔',
                'CNY': '중국 위안',
                'GBP': '영국 파운드',
                'CAD': '캐나다 달러',
                'AUD': '호주 달러',
                'HKD': '홍콩 달러',
                'SGD': '싱가포르 달러',
                'THB': '태국 바트',
                'INR': '인도 루피',
                'IDR': '인도네시아 루피아',
                'MYR': '말레이시아 링깃',
                'PHP': '필리핀 페소',
                'VND': '베트남 동',
                'BRL': '브라질 레알',
                'MXN': '멕시코 페소',
                'RUB': '러시아 루블',
                'CHF': '스위스 프랑',
                'SEK': '스웨덴 크로나',
                'NOK': '노르웨이 크로네',
                'DKK': '덴마크 크로네',
                'NZD': '뉴질랜드 달러',
                'ZAR': '남아프리카 랜드',
                'TRY': '터키 리라',
                'AED': '아랍에미리트 디르함',
                'SAR': '사우디아라비아 리얄',
                'ILS': '이스라엘 세켈',
                'EGP': '이집트 파운드'
            };

            // 통화 변환에 사용될 환율 정보 저장 객체
            let exchangeRates = {};
            let lastUpdated = null;
            let currentSelectingIndex = null;

            // 모든 통화 선택 요소와 입력 요소를 저장하는 배열
            const currencyElements = [];

            // 국가 목록 렌더링
            function renderCountryList(searchTerm = '') {
                countryList.innerHTML = '';
                const filteredCountries = countries.filter(country => 
                    country.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    country.code.toLowerCase().includes(searchTerm.toLowerCase())
                );

                filteredCountries.forEach(country => {
                    const item = document.createElement('div');
                    item.className = 'country-item';
                    item.innerHTML = `
                        <img src="${country.flag}" alt="${country.name}">
                        <span>${country.name} (${currencyNames[country.code]})</span>
                        <span class="currency-code">${country.code}</span>
                    `;
                    item.addEventListener('click', () => selectCountry(country));
                    countryList.appendChild(item);
                });
            }

            // 국가 선택 처리
            function selectCountry(country) {
                if (currentSelectingIndex !== null) {
                    const select = currencyElements[currentSelectingIndex].select;
                    select.innerHTML = `
                        <img src="${country.flag}" alt="${country.name}">
                        <span>${country.name} (${country.code})</span>
                    `;
                    select.dataset.currency = country.code;
                    closePopup();
                    loadExchangeRates();
                }
            }

            // 팝업 열기
            function openPopup(index) {
                currentSelectingIndex = index;
                countryPopup.classList.add('active');
                overlay.classList.add('active');
                countrySearch.value = '';
                renderCountryList();
            }

            // 팝업 닫기
            function closePopup() {
                countryPopup.classList.remove('active');
                overlay.classList.remove('active');
                currentSelectingIndex = null;
            }

            // 이벤트 리스너 설정
            countrySearch.addEventListener('input', (e) => {
                renderCountryList(e.target.value);
            });

            closeButton.addEventListener('click', closePopup);
            overlay.addEventListener('click', closePopup);

            // 초기 행 생성
            function createCurrencyRows() {
                currencyRowsDiv.innerHTML = '';
                const defaultCurrencies = ['KRW', 'USD', 'EUR', 'JPY', 'CNY'];
                
                defaultCurrencies.forEach((currency, index) => {
                    const row = document.createElement('div');
                    row.className = 'currency-row';
                    
                    // 통화 선택 버튼
                    const select = document.createElement('div');
                    select.className = 'currency-select';
                    select.id = `currency-select-${index}`;
                    const country = countries.find(c => c.code === currency);
                    select.innerHTML = `
                        <img src="${country.flag}" alt="${country.name}">
                        <span>${country.name} (${currency})</span>
                    `;
                    select.dataset.currency = currency;
                    select.addEventListener('click', () => openPopup(index));
                    
                    // 입력 필드
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'currency-input';
                    input.id = `currency-input-${index}`;
                    input.placeholder = '금액 입력';
                    input.value = index === 0 ? formatNumber('1000') : ''; // 첫 번째 행에 기본값 설정
                    
                    // 입력 이벤트 리스너 추가
                    input.addEventListener('input', function(e) {
                        // 숫자와 소수점만 입력 가능하도록 처리
                        let value = this.value.replace(/[^\d.]/g, '');
                        // 소수점이 여러 개 입력되는 것을 방지
                        const decimalCount = (value.match(/\./g) || []).length;
                        if (decimalCount > 1) {
                            value = value.substring(0, value.lastIndexOf('.'));
                        }
                        this.value = formatNumber(value);
                        convertFromInput(this, index);
                    });
                    
                    row.appendChild(select);
                    row.appendChild(input);
                    currencyRowsDiv.appendChild(row);
                    
                    // 요소 저장
                    currencyElements.push({
                        select: select,
                        input: input,
                        index: index
                    });
                });
            }

            // 환율 정보 로드
            function loadExchangeRates() {
                // 현재 선택된 모든 통화 코드 가져오기
                const selectedCurrencies = currencyElements.map(el => el.select.dataset.currency);
                
                // 중복 통화 확인
                const uniqueCurrencies = [...new Set(selectedCurrencies)];
                if (uniqueCurrencies.length !== selectedCurrencies.length) {
                    errorMessageDiv.textContent = '동일한 통화가 여러 개 선택되었습니다. 각 행에 서로 다른 통화를 선택해주세요.';
                    return;
                }
                
                errorMessageDiv.textContent = '';
                loadingDiv.style.display = 'block';
                
                // 기준 통화로 첫 번째 행의 통화 사용
                const baseCurrency = selectedCurrencies[0];
                
                // API 호출
                fetch(`https://api.exchangerate-api.com/v4/latest/${baseCurrency}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('환율 정보를 가져오는데 실패했습니다.');
                        }
                        return response.json();
                    })
                    .then(data => {
                        loadingDiv.style.display = 'none';
                        
                        // 환율 정보 저장
                        exchangeRates = data.rates;
                        lastUpdated = new Date(data.time_last_updated * 1000);
                        
                        // 업데이트 시간 표시
                        updateTimeDiv.textContent = `마지막 업데이트: ${lastUpdated.toLocaleDateString('ko-KR')} ${lastUpdated.toLocaleTimeString('ko-KR')}`;
                        
                        // 입력값 있는 경우 변환 실행
                        for (let i = 0; i < currencyElements.length; i++) {
                            if (currencyElements[i].input.value) {
                                convertFromInput(currencyElements[i].input, i);
                                break;
                            }
                        }
                        
                        // 입력값 없으면 첫 번째 입력에 기본값 설정
                        if (!currencyElements.some(el => el.input.value)) {
                            currencyElements[0].input.value = formatNumber('1000');
                            convertFromInput(currencyElements[0].input, 0);
                        }
                    })
                    .catch(error => {
                        loadingDiv.style.display = 'none';
                        errorMessageDiv.textContent = error.message;
                        console.error('Error:', error);
                    });
            }

            // 입력값 기준으로 다른 통화 변환
            function convertFromInput(inputElement, sourceIndex) {
                if (Object.keys(exchangeRates).length === 0) {
                    return; // 환율 정보가 없으면 변환 안함
                }
                
                // 천 단위 구분자 제거 후 숫자 변환
                const amount = parseFloat(inputElement.value.replace(/,/g, '')) || 0;
                if (amount <= 0) {
                    return;
                }
                
                const sourceCurrency = currencyElements[sourceIndex].select.dataset.currency;
                
                // 모든 행에 대해 변환
                currencyElements.forEach((el, index) => {
                    if (index !== sourceIndex) { // 입력한 행 제외
                        const targetCurrency = el.select.dataset.currency;
                        
                        // 같은 통화면 같은 값
                        if (targetCurrency === sourceCurrency) {
                            el.input.value = formatNumber(amount);
                            return;
                        }
                        
                        // 환율 계산
                        let convertedAmount;
                        if (sourceCurrency === currencyElements[0].select.dataset.currency) {
                            // 기준 통화에서 변환
                            convertedAmount = amount * exchangeRates[targetCurrency];
                        } else if (targetCurrency === currencyElements[0].select.dataset.currency) {
                            // 기준 통화로 변환
                            convertedAmount = amount / exchangeRates[sourceCurrency];
                        } else {
                            // 다른 통화끼리 변환 (기준 통화 경유)
                            const rateToBase = 1 / exchangeRates[sourceCurrency];
                            const rateFromBase = exchangeRates[targetCurrency];
                            convertedAmount = amount * rateToBase * rateFromBase;
                        }
                        
                        // 소수점 처리 (JPY는 정수로, 다른 통화는 소수점 2자리)
                        if (targetCurrency === 'JPY') {
                            el.input.value = formatNumber(Math.round(convertedAmount));
                        } else {
                            el.input.value = formatNumber(convertedAmount.toFixed(2));
                        }
                    }
                });
            }

            // 숫자 포맷팅 함수 (천 단위 구분자 추가)
            function formatNumber(number) {
                // 소수점이 있는 경우와 없는 경우를 구분하여 처리
                const parts = number.toString().split('.');
                parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                return parts.join('.');
            }

            // 초기화 및 환율 정보 로드
            createCurrencyRows();
            loadExchangeRates();
        });
    </script>
</body>
</html>